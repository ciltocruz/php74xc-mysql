os: linux
dist: bionic
language: shell

services:
  - docker

env:
  DOCKER_USERNAME: sineverba
  DOCKER_IMAGE: php74xc

before_install:
  - chmod +x ./.deploy/scripts/test.sh

install:
  - docker build --tag $DOCKER_USERNAME/$DOCKER_IMAGE .

script:
  - ./.deploy/scripts/test.sh

after_success:
  - |
    if [[ $TRAVIS_TAG != "" ]]; then
      echo "$DOCKER_TOKEN" | docker login -u "$DOCKER_USERNAME" --password-stdin
      docker push $DOCKER_USERNAME/$DOCKER_IMAGE
      docker rmi $DOCKER_USERNAME/$DOCKER_IMAGE
    fi