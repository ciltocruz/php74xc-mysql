os: linux
dist: focal
language: shell

services:
  - docker

env:
  DOCKER_USERNAME: sineverba
  DOCKER_IMAGE: php74xc

before_install:
  - docker -v | grep "19.03"
  - chmod +x ./deploy/scripts/test.sh
  - chmod +x ./deploy/scripts/deploy.sh

install:
  - echo "$DOCKER_TOKEN" | docker login -u "$DOCKER_USERNAME" --password-stdin
  - docker build --tag $DOCKER_USERNAME/$DOCKER_IMAGE .

script:
  - ./deploy/scripts/test.sh

after_success:
  - |
    if [[ $TRAVIS_TAG != "" ]]; then
      ./deploy/scripts/deploy.sh
    fi